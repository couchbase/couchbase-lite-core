<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LiteCore: Predictive (Machine-Learning) Query</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LiteCore
   </div>
   <div id="projectbrief">Couchbase Lite cross-platform core implementation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Predictive (Machine-Learning) Query</div></div>
</div><!--header-->
<div class="contents">

<p>This API allows you to register a machine-learning model with LiteCore.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_c4_predictive_model.html">C4PredictiveModel</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration struct for registering a predictive model.  <a href="struct_c4_predictive_model.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga13b1df0370356d4fb1336728c1c13283" id="r_ga13b1df0370356d4fb1336728c1c13283"><td class="memItemLeft" align="right" valign="top"><a class="el" href="c4_compat_8h.html#a172b88317c4e1248e156ca77731f1650">CBL_CORE_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga13b1df0370356d4fb1336728c1c13283">c4pred_registerModel</a> (const char *name, <a class="el" href="struct_c4_predictive_model.html">C4PredictiveModel</a>)</td></tr>
<tr class="memdesc:ga13b1df0370356d4fb1336728c1c13283"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers a predictive model, under a name.  <br /></td></tr>
<tr class="separator:ga13b1df0370356d4fb1336728c1c13283"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf93399045cd8cadf0db2e1237da19161" id="r_gaf93399045cd8cadf0db2e1237da19161"><td class="memItemLeft" align="right" valign="top"><a class="el" href="c4_compat_8h.html#a172b88317c4e1248e156ca77731f1650">CBL_CORE_API</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaf93399045cd8cadf0db2e1237da19161">c4pred_unregisterModel</a> (const char *name)</td></tr>
<tr class="memdesc:gaf93399045cd8cadf0db2e1237da19161"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unregisters whatever model was last registered with this name.  <br /></td></tr>
<tr class="separator:gaf93399045cd8cadf0db2e1237da19161"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This API allows you to register a machine-learning model with LiteCore. </p>
<p>It can then be invoked from a query by the PREDICTION() function. The model results can be indexed, to speed up queries, using the index type <code>kC4PredictiveIndex</code>.</p>
<p>A model is implemented with a callback that will be invoked during a query. The callback takes as input a set of named parameters, which are passed as a Fleece dictionary. It produces a set of named results, which it returns as another Fleece dictionary, encoded as data. This matches the APIs of libraries like CoreML and TensorFlow.</p>
<p>ML models often expect or produce multi-dimensional numeric arrays, which obviously aren't directly supported by Fleece nor JSON. It's up to you to translate them appropriately. The most direct translation is of arrays of arrays (of arrays...) of numbers, but this representation is pretty verbose and expensive to translate. You may want to store the raw array data in a blob instead, but this has its own issues like endianness and the need to know the array dimensions up-front.</p>
<p>The most common use of a multi-dimensional array is as an image pixmap; in this case the natural Fleece input is a blob containing encoded image data in a common format like JPEG or PNG. Again, you're responsible for decoding the image data and rendering it into the appropriate binary array. (Your ML library may assist you here; for example, CoreML works with the Vision framework, so all you have to do is pass in the encoded image data and the frameworks do the rest.)</p>
<p>You must be vigilant about invalid data, since the prediction query may well be run on documents that don't have the expected schema. Obviously the callback should not crash nor corrupt memory. It should also probably not return an error if input parameters are missing or of the wrong type; instead it should return null without storing an error value in the <code>error</code> parameter. The reason is that, if it returns an error, this will propagate all the way up the query and cause the entire query to fail. Usually it's more appropriate to return a null slice, which equates to a result of MISSING, which will just cause this document to fail the query condition. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga13b1df0370356d4fb1336728c1c13283" name="ga13b1df0370356d4fb1336728c1c13283"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga13b1df0370356d4fb1336728c1c13283">&#9670;&#160;</a></span>c4pred_registerModel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="c4_compat_8h.html#a172b88317c4e1248e156ca77731f1650">CBL_CORE_API</a> void c4pred_registerModel </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_c4_predictive_model.html">C4PredictiveModel</a></td>          <td class="paramname"><span class="paramname"><em></em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers a predictive model, under a name. </p>
<p>The model can now be invoked within a query by calling <code>prediction(_name_, _input_)</code>. The model remains registered until it's explicitly unregistered, or another model is registered with the same name. </p>

</div>
</div>
<a id="gaf93399045cd8cadf0db2e1237da19161" name="gaf93399045cd8cadf0db2e1237da19161"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf93399045cd8cadf0db2e1237da19161">&#9670;&#160;</a></span>c4pred_unregisterModel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="c4_compat_8h.html#a172b88317c4e1248e156ca77731f1650">CBL_CORE_API</a> bool c4pred_unregisterModel </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>name</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unregisters whatever model was last registered with this name. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
